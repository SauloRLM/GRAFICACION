<!DOCTYPE html>
<html>
    <head>
        <title>Trazado de líneas ecuación basica V1.1</title>
    </head>
    <body style="background-color: rgb(221, 99, 99);">
         <!--Lienzo para pintar las líneas -->
       <div align="center">
        <h1>Trazado de lineas basados en DDA</h1>
        <h3>Alumno: Lopez Mercado Saulo Ramon 402-Software</h3><br>
        <p align="left" style="margin-left: 35%;">Instruciones de uso:<br>
            1)-cliclea un punto en el lienzo manten precionado (punto inicial)<br>
            2)-Arrastra el mouse por el lienzo <br>
            3)-suelta el click (punto final) se formara la linea en base al algoritmo DDA
        </p><br>
        <canvas style="border: 3px solid; background-color: white;" id="lienzo" width="600" height="600" ></canvas> 
        <!--Función dibujar se ejecuta cada que se hace clic sobre el lienzo   onmousedown="dibujar(event)"-->
        <br><br>
        <input type="button" value="LimpiarPizarra" onclick="location.reload()"/>
       </div>

       <!--Script pintar las líneas utilizando javascript -->
       <script stype="text/javascript">
           //para limpiar pizzarra
           function actualizar(){location.reload(true);}
            //-------------------------------------------------------------------------------------

        //xi, yi se usan para guardar las coordenadas del primer punto de la recta    
        //la recta se define por dos puntos, el punto inicial de la recta
        //será la posición donde se haga clic por primera vez y el punto
        //final estara definido por la ubicacion de mouse
    
        function PintarPixel(contexto, x,y, color){//Pintar un punto
            contexto.fillStyle = color;
            // Grosor de línea los ultimos dos digitos            
            contexto.fillRect(x, y, 2, 2);
        }

        //Para pintar una recta esta función deberá ser ejecutada una vez
        //la primera vez captura las coordenadas del punto incial de la recta
        //y lo grafica sobre el lienzo. al momento de soltar el click  esta tomara el segundo punto
        //del segundo punto y pinta la línea llamando a la función lineaEcuacionRecta.
        
        //accedemos al lienzo de dibujo
        var xi=0;
        var yi=0;
        //Si es el primer clic, se lee el primer punto de la línea
        function click(event){
             xi=event.offsetX; //Guardamos la abscisa (x0)
             yi=event.offsetY; //guardamos la ordenada (y0)                                                
                //ponemos el punto inicial en azul
                PintarPixel(contexto, xi, yi, "blue");                 
                //Para poner la coordenada del punto
                //contexto.fillText( "(" + xi + "," + yi + ")", xi+4, yi);
        }

        function unclick(event){
            //Se ejecuta cada que se hace clic sobre el lienzo     
            //accedemos al lienzo de dibujo
            var canvas = document.getElementById("lienzo");        
            //obtenemos el contexto 2d del lienzo
            var contexto = canvas.getContext("2d");                                             
            
                //Si es el se solto el clic, pintamos la línea con los valores xi, yi
                //y la posición del último clic del ratón (event.offsetX, event.offsetY)
                //comparar  el valor del ultimo click para ver si es mayor o menor en el eje de las x
                //poner coordenada del punto
                //contexto.fillText( "(" + event.offsetX + "," + event.offsetY + ")", event.offsetX+4, event.offsetY);
                CalculosDePuntosBresenham(xi, yi, event.offsetX, event.offsetY, contexto, "blue");                
                //lineaBresenham(xi, yi, event.offsetX, event.offsetY, contexto, "blue");                
                
        }
        
        var canvas = document.getElementById("lienzo"); 
        canvas.addEventListener("mousedown",click);
        canvas.addEventListener("mouseup",unclick);

        /*
        function lineaBresenham(x0, y0, x1, y1, contexto, color){
                var dx = Math.abs(x1-x0);                
                var dy = Math.abs(y1-y0);

                var sx = (x0 < x1) ? 1 : -1;
                var sy = (y0 < y1) ? 1 : -1;

                var err = dx-dy;

            while(x0!=x1 || y0!=y1){
                PintarPixel(contexto, x0, y0, color);
                var e2 = 2*err;
                if (e2 >-dy){ err -= dy; x0 += sx; }
                if (e2 < dx){ err += dx; y0 += sy; }
            }
        }
        */

        function CalculosDePuntosBresenham(x0, y0, x1, y1, contexto, color){

            //var dx = Math.abs(x1-x0);
            //var dy = Math.abs(y1-y0);
            
            var x, y, dx, dy,pk, ddy, dresdydx, incx, incy;                        
                                //ddy   //dresdydx       //incx //incy
            dx = (x1 - x0); //delta de 
            //window.alert("dx= "+dx); 
            dy = (y1 - y0);
            //window.alert("dy= "+dy); 
            
            if (dy < 0) {  //si el delta dy es negativo significa que el el y0 es mayor al y1                 
                dy = -dy; //asi que se invierte y en ves de sumarle se le restara
                //window.alert("dy adentro del if= "+dy); 
                            
                incy = -1;
            } else {        //sino 
                incy = 1;   //se continua igual y se le aumentara 
            }

            if (dx < 0) {     // si el delta dx es menor a cero significa que el x0 es mayor a y1
                dx = -dx;       //asi que se invierte y en ves de sumarle se le restara
                //window.alert("dx adentro del if= "+dx); 
                incx = -1;
            } else {            //sino 
                incx = 1;      //se continua con normalidad y se le aumentara
            }

            x = x0;     //igualamos el x0 a x que sera la variables con las que se trabajan          
            y = y0;     //igualamos el y0 a y que sera la variables con las que se trabajan

            if (dx > dy) { //si delta de x es mayor a delta de y se hace en base a x y se calcula y

                pk = 2 * dy - dx; //calculamos pk
                ddy = 2 * dy; //calcula mos el valor de 2veces dy
                dresdydx = 2 * (dy - dx); //calculamos el valor de 2 veces la resta de dy -dx
                
                while (x != x1) {  //ejecutamos un while mientras que el x0 sea distinto a x1
                    x = x + incx;      //directamente le sumamos un a x para calcular xk+1
                    if (pk < 0) {      //decimos si p es menor a cero si es 
                        pk = pk + ddy;   //agregamos a pk el 2dy
                    } else {                //sino 
                        y = y + incy;  //amentamos y como lo indica la regla 
                        pk = pk + dresdydx;  //y recalculamos pk  agregamos a pk el 2dy-2dx
                    }
                    PintarPixel(contexto, x, y, color); //al final pintamos la nueva coordnada que es la siguiente                                                                                        
                }

            } else {  //sino y dy es mayor se hace lo mismo pero en base a y para calcular x
                pk = 2 * dx - dy; //calculamos pk
                ddy = 2 * dx;       //calcula mos el valor de 2veces dy
                dresdydx = 2 * (dx - dy); //calculamos el valor de 2 veces la resta de dy -dx
                while (y != y1) {       //ejecutamos un while mientras que el y0 sea distinto a y1
                    y = y + incy;       //directamente le sumamos el incremento a y para calcular yk+1
                    if (pk < 0) {       //decimos si pk es menor a cero si es 
                        pk = pk + ddy;  //agregamos a pk el 2dy
                    } else {            //sino 
                        x = x + incx;   //amentamos y como lo indica la regla 
                        pk = pk + dresdydx; //y recalculamos pk  agregamos a pk el 2dy-2dx
                    }
                    PintarPixel(contexto, x, y, color); //al final pintamos la nueva coordnada que es la siguiente                                                                                        
                }
            }                                                                                                             
        }
    </script>   
    </body>
</html>